*OpenSSL이 설치필요합니다.*
OpenSSL설치방법
cmd창에서

git clone https://github.com/Microsoft/vcpkg.git
cd vcpkg
vcpkg install openssl
vcpkg integrate install

이후 비주얼스튜디오 켜져있었으면 껏다키면 됩니다.


---



프로젝트 관리 
클라이언트와 서버프로젝트를 개별 솔루션으로 각각 관리하던 방식 -> 클라이언트와 서버 프로젝트를 단일솔루션에서 관리하는 방식으로 수정하였습니다.
로비서버는 여러개를 켤수있도록 main함수에서 인자를 받도록 설정하였습니다.
쿼리문은 DB폴더에 저장하였습니다.

---


네트워크
CustomOverlapped 객체를 Client에 멤버변수로 고정시켜놓고 char배열을 풀링해서 넣어주던 방식 -> CustomOverlapped객체에 char배열을 고정시켜놓고 CustomOverlapped를 풀링하는 방식으로 변경하였습니다.
네트워크연결에 필요한 Port,IP,BufferSize 등 정보중 컴파일전에 고정되는 값들은 Json파일로 저장후, ConstValue라는 스크립트에서 싱글톤으로 구현하여 전역접근이 가능하도록 구성해보았습니다. 'client_config.json'과 같은 파일입니다.


---


구현기능

-DB최신화
모든 DB정보의 갱신은 캐싱없이 즉각 이루어지도록 하였습니다.
따라서 항상 유저의 마지막상태가 저장됩니다.

-인증토큰
로비서버와 인증서버가 모두 알고있는 SecretKey를 기준으로 인증토큰을 발급하고, 검사합니다.
OpenSSL를 활용하였습니다.

- 동접 수에 따라 클라이언트가 접속할 로비 서버 선별 
로그인처리시 현재로그인처리된 유저의 수를 기준으로 로비서버가 Redis에 저장.
인증서버는 Redis에서 로비서버이름을 Key로 조회하여 그중 여유가 가장많은 포트번호를 클라이언트에 전송합니다.

-미인증 유저 연결해제
Lobby서버에 연결된 소켓중 로그인이 안된 소켓은 60초이후 연결해제하도록 하였습니다.

-유저활동기록 저장
로그인완료한 유저가 연결해제시 로그아웃처리 및 유저접속기록을 DB에 저장하였습니다.
아이템 분해시 변경되는 게임머니를 DB에 저장하였습니다.



---


시퀀스

클라이언트가 계정고유번호를 인증서버에 전달.
-> 인증서버는 DB에서 계정고유번호가 조회되지않으면 계정및 유저데이터기본값으로 저장 후 인증토큰 및 로비서버포트번호 발급.
-> 인증토큰을 받은 클라이언트는 발급받은 로비서버포트번호를 통해 로비서버에 계정고유번호와 토큰을 전달. 
-> 로비서버는 토큰유효성확인후 성공시 최종 로그인처리. 이후 유저정보 및 인벤토리정보를 클라이언트에 전달.
-> 로비서버는 최종로그인처리된 유저를 대상으로 60초마다 1~3개의 아이템을 지급한다.
-> 유저는 아이템을 지급받았을때 랜덤한 확률로 로비서버에 아이템분해요청을 한다.
-> 로비서버는 분해요청 처리후 바뀐 아이템정보, 유저의 게임머니정보를 유저에게 전송.












